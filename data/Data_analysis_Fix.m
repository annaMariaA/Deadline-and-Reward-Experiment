% ARH/AL March 2014. Code to process data from Anna's project looking at the effect of% reward on visual search strategies.% Data recorded from EyeLink 1000.% open the .asc file, get fixation and trial data, output to two separate% files for Alasdair.clear all;numSub = 47;filetomake = input('name the fixation results file: ', 's');F2ID = fopen(filetomake, 'a');fprintf(F2ID, 'subNum\t block\t trialNo\t fixNo\t xFix\t xFixFlipped\t yFix\t fixStartTime\t fixEndTime\t targPresent\t targSide\t easySide\t RT\t accuracy\n');block=2;   for bl=1:block     for subNo=1:numSub    condition = 'Ul';              filetoread = strcat(condition, num2str(subNo),'B',num2str(bl),'.asc'); % name of search data file to read        if (fopen(filetoread, 'r')~=-1)            FID=fopen(filetoread, 'r');            trialRunning = 0;            endtrialRun = 0;            trialCount = 0;            sacOnTime = 0;            fileRun = 1;            accuracy=0;            while fileRun                line=fgetl(FID); %get the next line of data                                if line == -1  % if the end of the file has been reached                    fclose(FID);                    fileRun = 0; %leave the main loop                    break;                    %     elseif findstr(line, 'TRIALNO_80')                    %         fclose(F2ID);                    %         fclose(FID);                    %         fileRun = 0; %leave the main loop                    %         break;                end                                if findstr(line, 'DISPLAY_ON')                    faceOn = 0;                    numFix = 0;                    targetsOn=0;                    trialCount = trialCount+1;                    failSacc=0;                    s=1;                    xPos=zeros(1,70);                    xPosFlipped=zeros(1,70);                    yPos=zeros(1,70);                    targPres='x';                    targSide='x';                    TargX1='-1';                    mes='GoodTrial';                    easySide='x';                    trialRunning =1; %start loop to get timing / saccade info from trial                    %         maxXvalue=0;                    while trialRunning                        line = fgetl(FID); %get data                        if findstr(line, 'FACES_DRAWN')                            index=findstr(line,'F');                                                        faceOnTime=str2num(line(4:index-1));                            faceOn = 1;                        end                        while faceOn                            line = fgetl(FID);                                                        if findstr(line, 'EFIX')                                                                efix = str2num(line(10:length(line)));                                numFix= numFix+1;                                if subNo<47                                xPos(1,numFix)=round(efix(4));                                yPos(1,numFix)=round(efix(5));                                else                                xPos(1,numFix)=round(efix(7));                                yPos(1,numFix)=round(efix(8));                                   end                                xPosFlipped(1,numFix)=xPos(1,numFix)-512;                                 fixStartT(1,numFix)=round(efix(1));                                fixEndT(1,numFix)=round(efix(2));                                                            end                            if findstr(line, 'Done')                                %endTime = str2num(line(4:11));                                faceOn = 0;                                break;                            end                                                        if strfind(line, 'TargPres_') %                                index = strfind(line, 'TargPres')+9;                                targPres =str2num(line(index:length(line)))                                                            end                                                                                    if strfind(line, 'TargSide_') %                                index = strfind(line, 'TargSide_')+9;                                targSide = line(index:length(line));                            end                                                        if strfind(line, 'RT_') %                               index = strfind(line, 'RT_')+3;                                RT = str2num(line(index:length(line)))                            end                            if strfind(line, 'Key_') %                               index = strfind(line, 'Key_')+4;                               response =line(index:length(line))                            end                                                                                    if findstr(line, 'Message_')                            index= strfind(line,'ge_')+3;                            message=(line(index:length(line)));                            cor=strcmp(message,mes);                            end                                                        if strfind(line, '-1.5')                            index= strfind(line,'-1.5')                            easySide=line(index-1)                            end                        end                                                if strfind(line, 'Done')                          if ((targPres == 0 && response == 'r') || (targPres == 1 && response == 'l'))                            accuracy = 1                          else                            accuracy = 0                          end                            for s=1%:numFix                                if easySide=='L'                                   xPosFlipped(1,s)=xPosFlipped(1,s)*(-1);                                end                                                             fprintf(F2ID, '%d\t %d\t %d\t %d\t %d\t %d\t %d\t %d\t %d\t %d\t %s\t %s\t %2.3f\t %d\n', subNo,bl,trialCount, s, round(xPos(1,s)),round(xPosFlipped(1,s)), round(yPos(1,s)), fixStartT(1,s), fixEndT(1,s), targPres, targSide, easySide, RT, accuracy);                                               end                            %save location of each item                                                        trialRunning = 0;                                                        break;                                 end                                            end                end            end        end   endendfclose(F2ID);